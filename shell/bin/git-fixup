#!/bin/sh

set -e

if [ "$#" -gt 1 ]; then
  {
    echo "Too many arguments to git-fixup."
    echo
    echo "Usage: git fixup [REVISION]"
  } >&2

  exit 1
fi

rev="${1:-HEAD}"
sub="$(git log -n1 --format=format:%s "$rev")"
opt="--fixup"

case "$sub" in "fixup! "*)
  opt="--reuse-message"
esac

exec git commit "$opt"="$rev"
